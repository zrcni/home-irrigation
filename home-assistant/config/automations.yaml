- alias: Trigger Sequential Watering Script
  trigger:
    # Trigger immediately when the device wakes up and sends new data
    - platform: state
      entity_id: sensor.plant_1_moisture
    - platform: state
      entity_id: sensor.plant_2_moisture
    - platform: state
      entity_id: sensor.plant_3_moisture
      
  condition:
    # This condition ensures the script only runs if AT LEAST ONE plant is dry
    # It also implicitly filters out 'unavailable' states
    - condition: or
      conditions:
        - condition: numeric_state
          entity_id: sensor.plant_1_moisture
          below: input_number.plant_1_min_moisture
        - condition: numeric_state
          entity_id: sensor.plant_2_moisture
          below: input_number.plant_2_min_moisture
        - condition: numeric_state
          entity_id: sensor.plant_3_moisture
          below: input_number.plant_3_min_moisture

  action:
    - service: script.sequential_plant_watering
